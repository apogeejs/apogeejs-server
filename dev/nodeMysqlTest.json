{"fileType":"apogee app js workspace","version":"0.60","references":{"viewState":{"treeState":1,"lists":{"npm module":{"treeState":0}}}},"code":{"model":{"fileType":"apogee model","version":0.3,"name":"DbTest","children":{"main":{"name":"main","type":"apogee.Folder","children":{"sql":{"name":"sql","type":"apogee.JsonMember","updateData":{"data":"select * from city;"}},"result":{"name":"result","type":"apogee.JsonMember","updateData":{"argList":[],"functionBody":"return dbConfig.getQueryPromise(sql);","supplementalCode":""}},"sql2":{"name":"sql2","type":"apogee.JsonMember","updateData":{"data":"select * from city where CountryCode = ? and Population > ?;"}},"parameters":{"name":"parameters","type":"apogee.Folder","children":{"layout":{"name":"layout","type":"apogee.FunctionMember","updateData":{"argList":[],"functionBody":"return [\n    {\n        type: \"heading\",\n        text: \"Test Input Parameters\"\n    },\n    {\n        type: \"textField\",\n        label: \"Country Code: \",\n        key: \"countryCode\"\n    },\n    {\n        type: \"textField\",\n        label: \"Minimum Population: \",\n        key: \"minPop\"\n    }\n]","supplementalCode":""}},"data":{"name":"data","type":"apogee.JsonMember","updateData":{"data":{"countryCode":"AFG","minPop":"100000"}}},"isInputValid":{"name":"isInputValid","type":"apogee.FunctionMember","updateData":{"argList":["formValue"],"functionBody":"//If data valid, return true. If data is invalid, return an error message.\nreturn true;","supplementalCode":""}}}},"result2":{"name":"result2","type":"apogee.JsonMember","updateData":{"argList":[],"functionBody":"let countryCode = parameters.data.countryCode;\nlet minPopString = parameters.data.minPop;\nif((countryCode)&&(minPopString)) {\n    let minPop = parseInt(minPopString);\n    return dbConfig.getPreparedQueryPromise(sql2,[countryCode,minPop]);\n}\nelse {\n    return \"-- INVALID QUERY --\";\n}","supplementalCode":""}}}},"dbConfig":{"name":"dbConfig","type":"apogee.Folder","children":{"getConnection":{"name":"getConnection","type":"apogee.FunctionMember","updateData":{"argList":[],"functionBody":"var mysql = require('mysql');\n\nreturn mysql.createConnection(config.data);","supplementalCode":""}},"getQueryPromise":{"name":"getQueryPromise","type":"apogee.FunctionMember","updateData":{"argList":["sql"],"functionBody":"let connection = getConnection();\n\nvar queryPromise = new Promise((resolve,reject) => {\n    connection.connect(function(err) {\n        if(err) {\n            reject(err.message);\n        }\n        else {    \n            connection.query(sql, function(err,result) {\n                if(err) {\n                    reject(err.message);\n                }\n                else {\n                    resolve(result);\n                }\n            });\n        }\n        connection.end();\n    });\n});\n\nreturn queryPromise;\n","supplementalCode":""}},"getPreparedQueryPromise":{"name":"getPreparedQueryPromise","type":"apogee.FunctionMember","updateData":{"argList":["sql","parameters"],"functionBody":"let connection = getConnection();\n\nvar queryPromise = new Promise((resolve,reject) => {\n    connection.connect(function(err) {\n        if(err) {\n            reject(err.message);\n        }\n        else {    \n            connection.query(sql, parameters, function(err,result) {\n                if(err) {\n                    reject(err.message);\n                }\n                else {\n                    resolve(result);\n                }\n            });\n        }\n        //just quit - don't bother handling an error for now\n        connection.end();\n    });\n});\n\nreturn queryPromise;","supplementalCode":""}},"config":{"name":"config","type":"apogee.Folder","children":{"layout":{"name":"layout","type":"apogee.FunctionMember","updateData":{"argList":[],"functionBody":"return [\n    {\n        type: \"heading\",\n        text: \"DB Configuration\"\n    },\n    {\n        type: \"textField\",\n        label: \"Host: \",\n        size: 40,\n        key: \"host\"\n    },\n    {\n        type: \"textField\",\n        label: \"User: \",\n        size: 40,\n        key: \"user\"\n    },\n    {\n        type: \"textField\",\n        label: \"Password: \",\n        size: 40,\n        key: \"password\"\n    },\n    {\n        type: \"textField\",\n        label: \"Database: \",\n        size: 40,\n        key: \"database\"\n    }\n]","supplementalCode":""}},"data":{"name":"data","type":"apogee.JsonMember","updateData":{"data":{"host":"localhost","user":"root","password":"admin","database":"world"}}},"isInputValid":{"name":"isInputValid","type":"apogee.FunctionMember","updateData":{"argList":["formValue"],"functionBody":"//If data valid, return true. If data is invalid, return an error message.\nreturn true;","supplementalCode":""}}}}}}}},"components":{"main":{"type":"apogeeapp.PageComponent","data":{"doc":{"type":"doc","content":[{"type":"heading1","content":[{"type":"text","text":"Test"}]},{"type":"paragraph","content":[{"type":"text","text":"This is a simple test. Below is an SQL query we want to do."}]},{"type":"apogeeComponent","attrs":{"name":"sql","id":0,"state":""}},{"type":"paragraph","content":[{"type":"text","text":"Here is the result:"}]},{"type":"apogeeComponent","attrs":{"name":"result","id":0,"state":""}},{"type":"heading1","content":[{"type":"text","text":"Test 2"}]},{"type":"paragraph","content":[{"type":"text","text":"Now we will try a parameterized query."}]},{"type":"apogeeComponent","attrs":{"name":"sql2","id":0,"state":""}},{"type":"paragraph"},{"type":"apogeeComponent","attrs":{"name":"parameters","id":0,"state":""}},{"type":"paragraph"},{"type":"apogeeComponent","attrs":{"name":"result2","id":0,"state":""}}]}},"children":{"sql":{"type":"apogeeapp.JsonCell","dataView":"Colorized","viewState":{"childDisplayState":{"views":{"Data":{"isViewActive":true,"height":280},"Formula":{"isViewActive":false},"Private":{"isViewActive":false}}}}},"result":{"type":"apogeeapp.JsonCell","dataView":"Colorized","viewState":{"childDisplayState":{"views":{"Data":{"isViewActive":true,"height":280},"Formula":{"isViewActive":true,"height":7000},"Private":{"isViewActive":false}}}}},"sql2":{"type":"apogeeapp.JsonCell","dataView":"Colorized","viewState":{"childDisplayState":{"views":{"Data":{"isViewActive":true,"height":280},"Formula":{"height":7000,"isViewActive":false},"Private":{"isViewActive":false}}}}},"parameters":{"type":"apogeeapp.DataFormCell","viewState":{"childDisplayState":{"views":{"Form":{"isViewActive":true},"Layout Code":{"height":7000,"isViewActive":false},"Layout Private":{"isViewActive":false},"isInputValid(formValue)":{"isViewActive":false},"isInputValid Private":{"isViewActive":false},"Form Value":{"height":280,"isViewActive":false}}}}},"result2":{"type":"apogeeapp.JsonCell","dataView":"Colorized","viewState":{"childDisplayState":{"views":{"Data":{"isViewActive":true,"height":280},"Formula":{"height":7000,"isViewActive":true},"Private":{"isViewActive":false}}}}}},"viewState":{"childDisplayState":null,"treeState":1,"tabOpened":true}},"dbConfig":{"type":"apogeeapp.PageComponent","data":{"doc":{"type":"doc","content":[{"type":"heading1","content":[{"type":"text","text":"Database Configuration"}]},{"type":"paragraph","content":[{"type":"text","text":"This is the configuration for our database connections."}]},{"type":"apogeeComponent","attrs":{"name":"config","id":0,"state":""}},{"type":"paragraph","content":[{"type":"text","text":"This function gets a connection."}]},{"type":"apogeeComponent","attrs":{"name":"getConnection","id":0,"state":""}},{"type":"paragraph","content":[{"type":"text","text":"This function gets a promise for the given SQL query."}]},{"type":"apogeeComponent","attrs":{"name":"getQueryPromise","id":0,"state":""}},{"type":"paragraph","content":[{"type":"text","text":"This function gets a promise for the parameterized SQL query."}]},{"type":"paragraph","content":[{"type":"text","text":"The parameters object should be an array of parameter values, given in the order specified in the SQL query."}]},{"type":"apogeeComponent","attrs":{"name":"getPreparedQueryPromise","id":0,"state":""}},{"type":"paragraph"}]}},"children":{"getConnection":{"type":"apogeeapp.FunctionCell","viewState":{"childDisplayState":{"views":{"Code":{"isViewActive":false,"height":7000},"Private":{"isViewActive":false}}}}},"getQueryPromise":{"type":"apogeeapp.FunctionCell","viewState":{"childDisplayState":{"views":{"Code":{"isViewActive":false,"height":7000},"Private":{"isViewActive":false}}}}},"getPreparedQueryPromise":{"type":"apogeeapp.FunctionCell","viewState":{"childDisplayState":{"views":{"Code":{"isViewActive":false,"height":7000},"Private":{"isViewActive":false}}}}},"config":{"type":"apogeeapp.DataFormCell","viewState":{"childDisplayState":{"views":{"Form":{"isViewActive":true},"Layout Code":{"height":7000,"isViewActive":false},"Layout Private":{"isViewActive":false},"isInputValid(formValue)":{"isViewActive":false},"isInputValid Private":{"isViewActive":false},"Form Value":{"height":280,"isViewActive":false}}}}}},"viewState":{"childDisplayState":null,"treeState":1,"tabOpened":true,"tabShowing":true}},"viewState":{"treeState":1}}},"viewState":{"treeState":1}}